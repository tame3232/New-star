<!DOCTYPE html>
<html lang="am">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>á‹¨á‹•áˆˆá‰³á‹Š á‰°áŒá‰£áˆ«á‰µ áˆ˜á‰°áŒá‰ áˆªá‹« - á‰‹áˆš áŠáŒ¥á‰¥</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* ========================================= */
        /* á‹¨ CSS á‰…áŒ¦á‰½ (Styling) - áˆ³á‹­á‰€á‹¨áˆ­ á‹­á‰€áˆ«áˆ */
        /* ========================================= */

        :root {
            --et-yellow: #FFC107;
            --et-green: #4CAF50;
            --et-purple: #9C27B0;
            --et-red: #F44336;
            --et-blue: #2196F3;
        }

        body {
            background-color: var(--tg-theme-bg-color, #212121);
            color: var(--tg-theme-text-color, #FFFFFF);
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        }

        #root {
            min-height: 100vh;
            padding: 15px;
            box-sizing: border-box;
        }

        .header-title-container {
            text-align: center;
            margin-bottom: 20px;
        }

        .main-title {
            color: var(--tg-theme-text-color);
            font-size: 18px;
            font-weight: bold;
        }
        
        /* --- á‹¨áŒŠá‹œ á‰†áŒ£áˆª --- */
        .time-counter-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
        }

        .time-box {
            background-color: #383838;
            padding: 10px 15px;
            border-radius: 8px;
            margin: 0 5px;
        }

        .time-box span {
            font-size: 28px;
            font-weight: bold;
        }

        .colon {
            font-size: 28px;
            font-weight: bold;
            margin: 0 2px;
        }

        /* --- á‹•áˆˆá‰³á‹Š á‰°áŒá‰£áˆ«á‰µ áŠ á‹áˆ«áˆ®á‰½ --- */
        .daily-tasks-container {
            display: flex;
            justify-content: space-between;
            gap: 10px;
            margin-bottom: 20px;
        }

        .task-button {
            flex: 1;
            padding: 20px 0;
            border-radius: 10px;
            border: none;
            font-weight: bold;
            font-size: 16px;
            color: #212121;
            position: relative;
            cursor: pointer;
        }

        .daily-badge {
            position: absolute;
            top: -10px;
            right: -5px;
            background-color: var(--et-red);
            color: white;
            font-size: 10px;
            font-weight: bold;
            padding: 2px 8px;
            border-radius: 10px;
        }

        /* --- á‹¨áŠ«áˆ­á‹µ áŠ á‹áˆ«áˆ®á‰½ --- */
        .card-button {
            display: flex;
            align-items: center;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            text-align: left;
            border: none;
            width: 100%;
            cursor: pointer;
            background-color: white;
            color: #212121;
        }

        .card-button.dark {
            background-color: #424242;
            color: white;
        }

        .card-icon-circle {
            width: 40px;
            height: 40px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-size: 20px;
        }
        
        .card-button:nth-child(1) .card-icon-circle { background-color: var(--et-red); }
        .card-button:nth-child(2) .card-icon-circle { background-color: var(--et-blue); }
        .card-button:nth-child(3) .card-icon-circle { background-color: var(--et-purple); }

        .card-text-container {
            flex: 1;
        }

        .card-title {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 3px;
            color: inherit;
        }

        .card-button.dark .card-subtitle {
            color: #BDBDBD;
        }
        
        .card-subtitle {
            font-size: 12px;
            color: gray;
        }

        .arrow-icon {
            font-size: 24px;
            color: var(--et-red);
            margin-left: 10px;
        }

        /* --- á‹¨áŠ¥áŠ•áŠ³áŠ• á‹°áˆ…áŠ“ áˆ˜áŒ¡ áŠ«áˆ­á‹µ --- */
        .welcome-card {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #383838;
            padding: 15px;
            border-radius: 10px;
            margin-top: 10px;
        }

        .welcome-card-content {
            display: flex;
            align-items: center;
        }

        .welcome-icon-circle {
            background-color: var(--et-yellow);
            width: 40px;
            height: 40px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            font-size: 20px;
        }

        .welcome-title {
            color: white;
            font-weight: bold;
        }

        .welcome-subtitle {
            color: #BDBDBD;
            font-size: 12px;
        }

        button {
            font-family: inherit;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script>
        // =========================================
        // á‹¨ JavaScript áˆáŒ‚áŠ­
        // =========================================

        const WebApp = window.Telegram.WebApp;

        // á‹¨áŠ¢á‰µá‹®áŒµá‹« á‰€áˆˆáˆ (Constants)
        const ET_GREEN = '#4CAF50';
        const ET_YELLOW = '#FFC107';

        // áˆˆáŠáŒ¥á‰¥ áˆ›áˆ³á‹« á‹¨áˆšáˆ†áŠ• áŠ áˆˆáˆ áŠ á‰€á á‰°áˆˆá‹‹á‹‹áŒ­
        let currentScore = 0; 
        
        // **********************************************
        // 1. Backend (Netlify Function) á‹áˆ…á‹°á‰µ Logic
        // **********************************************
        
        // áŠáŒ¥á‰¥ á‹ˆá‹° áŠ”á‰µáˆŠá‹á‹­ á‰°áŒá‰£áˆ­ áˆˆáˆ˜áˆ‹áŠ­
        async function saveScoreToBackend(scoreToAdd) {
            // áŠ¨á‰´áˆŒáŒáˆ«áˆ á‹¨á‰°áŒ á‰ƒáˆš áˆ˜áˆ¨áŒƒáŠ• áˆ˜á‹áˆ°á‹µ (áˆˆáˆ›áˆ¨áŒ‹áŒˆáŒ¥)
            const userData = WebApp.initDataUnsafe.user; 
            
            if (!userData) {
                WebApp.showAlert('á‹¨á‰°áŒ á‰ƒáˆš áˆ˜áˆ¨áŒƒ áŠ áˆá‰°áŒˆáŠ˜áˆ! áŠ¥á‰£áŠ­á‹ áŠ¥áŠ•á‹°áŒˆáŠ“ á‹­áˆáŠ­áˆ©á¢');
                return false;
            }

            // á‹¨ POST áŒ¥á‹«á‰„ á‹ˆá‹° Netlify Function áˆ˜áˆ‹áŠ­
            try {
                // áŒ¥á‹«á‰„á‹ á‹ˆá‹° netlify/tbot_handler.js á‹­áˆ„á‹³áˆ (á‰  netlify.toml áˆ‹á‹­ á‰£á‹‹á‰€áˆ­áŠá‹ áˆ˜áˆ°áˆ¨á‰µ)
                const response = await fetch('/.netlify/functions/tbot_handler', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        userId: userData.id,      // á‹¨á‰´áˆŒáŒáˆ«áˆ áˆ˜áˆˆá‹«
                        username: userData.username,
                        score: scoreToAdd         // á‹¨áˆšáŒ¨áˆ˜áˆ¨á‹ áŠáŒ¥á‰¥
                    })
                });

                const data = await response.json();

                if (response.ok && data.success) {
                    // áŠáŒ¥á‰¡ áŠ¨á‰°áˆ˜á‹˜áŒˆá‰  á‰ áŠ‹áˆ‹ áŠ áˆˆáˆ áŠ á‰€á á‰°áˆˆá‹‹á‹‹áŒ­áŠ• áˆ›á‹˜áˆ˜áŠ•
                    currentScore = data.newScore; 
                    WebApp.showAlert(`áˆµáŒ¦á‰³á‹ á‰°á‰€á‰¥áˆˆá‹‹áˆ! áŠ á‹²áˆµ áŠáŒ¥á‰¥á‹: ${data.newScore} ğŸ’°`);
                    return true;
                } else {
                    WebApp.showAlert(`áŠáŒ¥á‰¥ áˆ›áˆµá‰€áˆ˜áŒ¥ áŠ áˆá‰°áˆ³áŠ«áˆ: ${data.message || 'á‹«áˆá‰³á‹ˆá‰€ áˆµáˆ…á‰°á‰µ'}`);
                    return false;
                }
            } catch (error) {
                WebApp.showAlert('áŠ¨ Backend áŒ‹áˆ­ á‰ áˆ˜áŒˆáŠ“áŠ˜á‰µ áˆ‹á‹­ áˆµáˆ…á‰°á‰µ á‰°áˆáŒ áˆ¨á¢');
                console.error("Backend/Netlify Function áˆµáˆ…á‰°á‰µ:", error);
                return false;
            }
        }
        
        // áŠ¨áŠ áŒˆáˆáŒ‹á‹© áŠáŒ¥á‰¡áŠ• áˆˆáˆ›áŒáŠ˜á‰µ (á‰ áŠ¥á‹«áŠ•á‹³áŠ•á‹± áŒŠá‹œ áŠ á‘ áˆ²áŠ¨áˆá‰µ)
        async function fetchCurrentScore() {
            const userData = WebApp.initDataUnsafe.user;
            if (!userData) return;

            try {
                // áŠáŒ¥á‰¡áŠ• á‹¨áˆšáŒ á‹­á‰… API (á‹­áˆ…áˆ á‰  tbot_handler.js á‹áˆµáŒ¥ áˆ˜áˆáŒ áˆ­ áŠ áˆˆá‰ á‰µ)
                // áŠ áˆáŠ• á‰£áˆˆá‹ tbot_handler.js á‹áˆµáŒ¥ á‹¨ GET API áˆµáˆˆáˆŒáˆˆá£ POST API áŠ• áˆˆáŒŠá‹œá‹ áŠ¥áŠ•áŒ á‰€áˆ›áˆˆáŠ• (áŒ¥áˆ© áˆáˆ›á‹µ áŠ á‹­á‹°áˆˆáˆ)
                // áˆˆá‰µáŠ­áŠ­áˆˆáŠ›á‹ áˆáˆ›á‰µá£ GET /api/score?userId=... á‹¨áˆšáˆ Function á‹«áˆµáˆáˆáŒ‹áˆá¢
                
                // áˆˆáˆáˆ³áˆŒá‹«á‰½áŠ•á£ áŠáŒ¥á‰¡áŠ• áŠ¨áˆ›á‹˜áˆ˜áŠ›á‹ API (POST) áŒ‹áˆ­ áŠ á‰¥áˆ® áŠ¥áŠ•á‹°áˆšáˆ˜áŒ£ áŠ¥áŠ•áŒˆáˆá‰³áˆˆáŠ•á£ 
                // á‹ˆá‹­áˆ áŠ¥áˆµáŠªá‹˜áˆ˜áŠ• á‹µáˆ¨áˆµ áŠáŒ¥á‰¡áŠ• á‹œáˆ® (0) áŠ á‹µáˆ­áŒˆáŠ• áŠ¥áŠ•áŒ€áˆáˆ«áˆˆáŠ•á¢
                
                // á‰ áŠ áˆáŠ‘ tbot_handler.js á‹áˆµáŒ¥ áŠáŒ¥á‰¥áŠ• á‰¥á‰» á‹¨áˆšáŒ á‹­á‰… API áˆµáˆˆáˆŒáˆˆá£
                // áˆ˜á‰°áŒá‰ áˆªá‹«á‹ áˆˆáˆ˜áŒ€áˆ˜áˆªá‹« áŒŠá‹œ áˆ²áŠ¨áˆá‰µ áŠáŒ¥á‰¡áŠ• á‹œáˆ® (0) áŠ á‹µáˆ­áŒˆáŠ• áŠ¥áŠ•áŒ€áˆáˆ«áˆˆáŠ•á¢
                // á‹ˆá‹­áˆ:
                
                // áŒŠá‹œá‹«á‹Š áˆ˜áá‰µáˆ„á¡ áŠ¨ Local Storage áˆ›áŠ•á‰ á‰¥ (á‹¨áˆ˜áŒ€áˆ˜áˆªá‹«á‹áŠ• á‹‹áŒ‹ á‰¥á‰»)
                currentScore = parseInt(localStorage.getItem('tempInitialScore') || '0', 10);

            } catch (e) {
                console.error("á‹¨áˆ˜áŒ€áˆ˜áˆªá‹« áŠáŒ¥á‰¥ á‰ áˆ›áŒáŠ˜á‰µ áˆ‹á‹­ áˆµáˆ…á‰°á‰µ:", e);
            }
        }
        
        // --- áŠ•á‹‘áˆµ áŠ®áˆá–áŠáŠ•á‰¶á‰½ (Sub-Components) ---

        function TimeBox(value) { /* ... áˆ³á‹­á‰€á‹¨áˆ­ á‹­á‰€áˆ«áˆ ... */ return `<div class="time-box"><span>${value}</span></div>`; }

        function TaskButton(color, label, isDaily = false) {
            // á‰°áŒá‰£áˆ­ áˆ²áŒ«áŠ• á‰‹áˆš áŠáŒ¥á‰¥ á‹ˆá‹° Backend áˆ˜áˆ‹áŠ­
            return `
                <button class="task-button" style="background-color: ${color};" onclick="handleTaskClick('${label}', 100);">${isDaily ? '<div class="daily-badge">Daily</div>' : ''}${label}</button>
            `;
        }
        
        // á‹¨á‰°áŒá‰£áˆ­ á‰áˆá áˆ²áŒ«áŠ• á‹¨áˆšáˆ°áˆ«á‹
        async function handleTaskClick(taskName, points) {
            const success = await saveScoreToBackend(points);
            if(success) {
                // áŠáŒ¥á‰¡ áŠ¨á‰°áˆ˜á‹˜áŒˆá‰  á‰ áŠ‹áˆ‹ áŒˆáŒ¹áŠ• áˆ›á‹˜áˆ˜áŠ•
                renderApp();
            }
        }

        function CardButton(icon, title, subtitle, isDark, onNavigate) { /* ... áˆ³á‹­á‰€á‹¨áˆ­ á‹­á‰€áˆ«áˆ ... */
            const darkClass = isDark ? 'dark' : '';
            return `
                <button 
                    class="card-button ${darkClass}" 
                    onclick="${onNavigate}">
                    <div class="card-icon-circle">
                        <span class="icon">${icon}</span>
                    </div>
                    <div class="card-text-container">
                        <div class="card-title">${title}</div>
                        <div class="card-subtitle">${subtitle}</div>
                    </div>
                    <div class="arrow-icon">â†’</div>
                </button>
            `;
        }

        function WelcomeCard() {
            // Main ButtonáŠ• áˆ›á‹˜áŒ‹áŒ€á‰µ
            const handleGiftClaim = async () => {
                const scoreToAdd = 500;
                const success = await saveScoreToBackend(scoreToAdd);

                if (success) {
                    WebApp.MainButton.hide(); 
                    WebApp.MainButton.offClick(handleGiftClaim);
                    renderApp(); // áŠáŒ¥á‰¡ áŠ¨á‰°áˆ˜á‹˜áŒˆá‰  á‰ áŠ‹áˆ‹ áŒˆáŒ¹áŠ• áˆ›á‹˜áˆ˜áŠ•
                }
            };

            WebApp.MainButton.setText(`áˆµáŒ áŠ! (+500 áˆ³áŠ•á‰²áˆ)`);
            WebApp.MainButton.show();
            WebApp.MainButton.setParams({
                color: ET_GREEN,
                text_color: '#FFFFFF'
            });

            WebApp.MainButton.onClick(handleGiftClaim);

            return `
                <div class="welcome-card">
                    <div class="welcome-card-content">
                        <div class="welcome-icon-circle">ğŸ</div>
                        <div>
                            <div class="welcome-title">á‹•áˆˆá‰³á‹Š áˆµáŒ¦á‰³</div>
                            <div class="welcome-subtitle">áŠ áˆáŠ• á‹«áˆˆá‹á‰µ áŠáŒ¥á‰¥: ${currentScore} ğŸ’°</div>
                        </div>
                    </div>
                </div>
            `;
        }

        // --- á‹‹áŠ“á‹ á‹¨áˆ›áˆ³á‹« á‰°áŒá‰£áˆ­ (Main Render Function) ---
        async function renderApp() {
            // á‰´áˆŒáŒáˆ«áˆ Mini AppáŠ• áˆ›á‹˜áŒ‹áŒ€á‰µ
            WebApp.ready(); 
            WebApp.setHeaderColor('secondary_bg_color');
            WebApp.BackButton.show();
            WebApp.BackButton.onClick(() => WebApp.close()); 

            // áŠáŒ¥á‰¡áŠ• áŠ¨ Backend áˆˆáˆ˜á‹áˆ°á‹µ á‹¨áˆ˜áŒ€áˆ˜áˆªá‹« áŒ¥áˆª
            // á‹­áˆ… á‹¨áˆšáˆ†áŠá‹ áŠáŒ¥á‰¡áŠ• áˆˆáˆ›áˆµá‰€áˆ˜áŒ¥ á‰ áˆšá‹°áˆ¨áŒˆá‹ áŒ¥áˆª á‹áˆµáŒ¥ áˆµáˆˆáˆ†áŠá£ 
            // áŒˆáŒ¹ áˆ˜áŒ€áˆ˜áˆªá‹« áˆ²áŠ¨áˆá‰µ áŠáŒ¥á‰¡áŠ• áˆˆáˆ›áŒáŠ˜á‰µ á‹¨á‰°áˆˆá‹¨ GET API á‹«áˆµáˆáˆáŒ‹áˆá¢
            // áˆˆá‹šáˆ… áˆáˆ³áˆŒá£ áŒˆáŒ¹ áˆ²áŠ¨áˆá‰µ á‹¨áˆ›áˆµá‰€áˆ˜áŒ« API áŠ• áˆ˜áŒ¥áˆ«á‰µ áŠ áŠ•á‰½áˆáˆá¢
            // áˆµáˆˆá‹šáˆ…á£ áŠáŒ¥á‰¡áŠ• áŠ¨áˆ˜áŒ€áˆ˜áˆªá‹«á‹ á‰ áŠá‰µ áˆˆáˆ›áŒáŠ˜á‰µ **GET API** áˆ˜ááŒ áˆ­ á‹«áˆµáˆáˆáŒ‹áˆá¢
            
            // á‹¨ GET API áŠ¥áˆµáŠ­áŠ•áˆáŒ¥áˆ­ á‹µáˆ¨áˆµá£ áŠáŒ¥á‰¡áŠ• á‰ á‰µáŠ­áŠ­áˆ áˆˆáˆ›áŒáŠ˜á‰µ
            // áŒˆáŒ¹ áˆ²áŠ¨áˆá‰µ "0" (á‹ˆá‹­áˆ á‹¨áˆ˜áŒ¨áˆ¨áˆ»á‹ Local Storage á‹‹áŒ‹) áŠ¥áŠ“áˆ³á‹«áˆˆáŠ•á¢
            await fetchCurrentScore(); 

            const appContent = `
                <div class="app-container">
                    <div class="header-title-container">
                        <h1 class="main-title">á‹•áˆˆá‰³á‹Š á‰°áŒá‰£áˆ«á‰µ á‹áˆ­á‹áˆ­</h1>
                    </div>

                    <p style="text-align: center; font-size: 16px; font-weight: bold; margin-bottom: 10px;">
                        áŒ á‰…áˆ‹áˆ‹ áŠáŒ¥á‰¥: <span style="color: ${ET_YELLOW};">${currentScore} ğŸ’°</span>
                    </p>
                    
                    <div class="time-counter-container">
                        ${TimeBox('23')}
                        <div class="colon">:</div>
                        ${TimeBox('59')}
                        <div class="colon">:</div>
                        ${TimeBox('06')}
                    </div>

                    <div class="daily-tasks-container">
                        ${TaskButton(ET_YELLOW, 'Scratch', true)}
                        ${TaskButton(ET_GREEN, 'Streak')}
                        ${TaskButton('#9C27B0', 'Lucky Box')}
                    </div>

                    ${CardButton( 'ğŸš€', 'ROAD ğŸš€ á‹¨á‰°áˆ»áˆˆá‹áŠ• áˆ˜áŠ•áŒˆá‹µ', 'á‰ á‰€áˆ‹áˆ‰ á‰µáˆ­á á‹¨áˆšá‹«áˆµáŒˆáŠáˆá‹á‰µáŠ• á‹¨áˆáˆ›á‰µ áˆ˜áˆµáˆ˜áˆ­ áˆ˜áˆáˆ¨áŒ¥ á‹­á‰½áˆ‹áˆ‰á¢', false, "WebApp.showAlert('á‹ˆá‹° ROAD áŒˆáŒ½ á‹­áˆ‚á‹±')" )}
                    
                    ${CardButton( 'ğŸ®', 'GAME ğŸ® áŠ á‹³á‹²áˆµ áŒ¨á‹‹á‰³á‹á‰½', 'á‹¨á‰°áˆˆá‹«á‹© áŠ á‹áŠ“áŠ áŠ¥áŠ“ áŠ á‰µáˆ«áŠ áŒ¨á‹‹á‰³á‹á‰½áŠ• á‹­áˆáŠ­áˆ©á¢', true, "WebApp.showAlert('á‹ˆá‹° áŒ¨á‹‹á‰³á‹á‰½ áŒˆáŒ½ á‰ áˆ˜áˆ„á‹µ áˆ‹á‹­...')" )}

                    ${CardButton( 'ğŸ’¡', '100X ğŸ’¡ á‹¨áŒ¥á‰ á‰ƒ áŒ¥á‰†áˆ›á‹á‰½', 'á‰ áŒáŠ•á‹›á‰¤á‹ áˆ‹á‹­ áˆ˜á‹°ááˆ¨áˆµ á‹¨áˆŒáˆˆá‰ á‰µáŠ• áˆ˜áˆ¨áŒƒá‹á‰½áŠ• áˆ°á‰¥áˆµá‰ áŠ• áŠ¥áŠ“áˆµá‰€áˆáŒ¥áˆá‹á‰³áˆˆáŠ•á¢ (5/24 áˆ°á‹“á‰µ)', true, "WebApp.showAlert('á‹ˆá‹° 100X áŒˆáŒ½ á‹­áˆ‚á‹±')" )}

                    ${WelcomeCard()}
                </div>
            `;

            document.getElementById('root').innerHTML = appContent;
        }

        // áŒˆáŒ¹ áŠ¨á‰°áŒ«áŠ á‰ áŠ‹áˆ‹ á‹¨áˆ›áˆ³á‹« á‰°áŒá‰£áˆ­áŠ• áˆ˜áŒ¥áˆ«á‰µ
        window.onload = renderApp;
    </script>
</body>
</html>
